<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Login - ProjectD</title>
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>
  <div class="container">
    <h1>Login to ProjectD</h1>
    <section>
      <h2>Authentication</h2>
      <input type="text" id="login-username" placeholder="Username" />
      <input type="password" id="login-password" placeholder="Password" />
      <button onclick="handleLogin()">Login</button>
      <div id="login-result" class="result"></div>
    </section>
  </div>

  <script>
    const API_BASE_URL = 'https://projectje-d6d4arfxb6anhrcj.westeurope-01.azurewebsites.net';

    async function handleLogin() {
      const username = document.getElementById('login-username').value.trim();
      const password = document.getElementById('login-password').value.trim();
      const resultDiv = document.getElementById('login-result');
      resultDiv.innerHTML = '';

      if (!username || !password) {
        resultDiv.innerHTML = '<span style="color:red">Please enter both username and password.</span>';
        return;
      }

      try {
        const response = await fetch(`${API_BASE_URL}/api/auth/login`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Cache-Control': 'no-cache, no-store, must-revalidate',
            'Pragma': 'no-cache',
            'Expires': '0'
          },
          body: JSON.stringify({ Username: username, Password: password })
        });

        const contentType = response.headers.get('content-type');
        if (contentType && contentType.includes('application/json')) {
          const data = await response.json();
          if (response.ok && data.token) {
            sessionStorage.setItem('bearerToken', data.token);
            // Redirect to main page
            window.location.href = 'index.html';
          } else {
            resultDiv.innerHTML = `<span style='color:red'>${data.message || 'Login failed'}</span>`;
          }
        } else {
          const text = await response.text();
          resultDiv.innerHTML = `<span style='color:red'>${text || 'Login failed'}</span>`;
        }
      } catch (err) {
        resultDiv.innerHTML = `<span style='color:red'>Error: ${err.message}</span>`;
      }
    }
  </script>
</body>
</html>
